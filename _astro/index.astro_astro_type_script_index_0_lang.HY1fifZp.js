var w={exports:{}},P;function U(){if(P)return w.exports;P=1;var h=typeof Reflect=="object"?Reflect:null,e=h&&typeof h.apply=="function"?h.apply:function(t,r,s){return Function.prototype.apply.call(t,r,s)},i;h&&typeof h.ownKeys=="function"?i=h.ownKeys:Object.getOwnPropertySymbols?i=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:i=function(t){return Object.getOwnPropertyNames(t)};function l(n){console&&console.warn&&console.warn(n)}var f=Number.isNaN||function(t){return t!==t};function a(){a.init.call(this)}w.exports=a,w.exports.once=G,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var b=10;function g(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(n){if(typeof n!="number"||n<0||f(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");b=n}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||f(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function O(n){return n._maxListeners===void 0?a.defaultMaxListeners:n._maxListeners}a.prototype.getMaxListeners=function(){return O(this)},a.prototype.emit=function(t){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var o=t==="error",c=this._events;if(c!==void 0)o=o&&c.error===void 0;else if(!o)return!1;if(o){var u;if(r.length>0&&(u=r[0]),u instanceof Error)throw u;var d=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw d.context=u,d}var m=c[t];if(m===void 0)return!1;if(typeof m=="function")e(m,this,r);else for(var j=m.length,B=_(m,j),s=0;s<j;++s)e(B[s],this,r);return!0};function S(n,t,r,s){var o,c,u;if(g(r),c=n._events,c===void 0?(c=n._events=Object.create(null),n._eventsCount=0):(c.newListener!==void 0&&(n.emit("newListener",t,r.listener?r.listener:r),c=n._events),u=c[t]),u===void 0)u=c[t]=r,++n._eventsCount;else if(typeof u=="function"?u=c[t]=s?[r,u]:[u,r]:s?u.unshift(r):u.push(r),o=O(n),o>0&&u.length>o&&!u.warned){u.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=n,d.type=t,d.count=u.length,l(d)}return n}a.prototype.addListener=function(t,r){return S(this,t,r,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,r){return S(this,t,r,!0)};function I(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(n,t,r){var s={fired:!1,wrapFn:void 0,target:n,type:t,listener:r},o=I.bind(s);return o.listener=r,s.wrapFn=o,o}a.prototype.once=function(t,r){return g(r),this.on(t,C(this,t,r)),this},a.prototype.prependOnceListener=function(t,r){return g(r),this.prependListener(t,C(this,t,r)),this},a.prototype.removeListener=function(t,r){var s,o,c,u,d;if(g(r),o=this._events,o===void 0)return this;if(s=o[t],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,s.listener||r));else if(typeof s!="function"){for(c=-1,u=s.length-1;u>=0;u--)if(s[u]===r||s[u].listener===r){d=s[u].listener,c=u;break}if(c<0)return this;c===0?s.shift():D(s,c),s.length===1&&(o[t]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",t,d||r)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var r,s,o;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var c=Object.keys(s),u;for(o=0;o<c.length;++o)u=c[o],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(t,r[o]);return this};function x(n,t,r){var s=n._events;if(s===void 0)return[];var o=s[t];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?$(o):_(o,o.length)}a.prototype.listeners=function(t){return x(this,t,!0)},a.prototype.rawListeners=function(t){return x(this,t,!1)},a.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):N.call(n,t)},a.prototype.listenerCount=N;function N(n){var t=this._events;if(t!==void 0){var r=t[n];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function _(n,t){for(var r=new Array(t),s=0;s<t;++s)r[s]=n[s];return r}function D(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function $(n){for(var t=new Array(n.length),r=0;r<t.length;++r)t[r]=n[r].listener||n[r];return t}function G(n,t){return new Promise(function(r,s){function o(u){n.removeListener(t,c),s(u)}function c(){typeof n.removeListener=="function"&&n.removeListener("error",o),r([].slice.call(arguments))}R(n,t,c,{once:!0}),t!=="error"&&k(n,o,{once:!0})})}function k(n,t,r){typeof n.on=="function"&&R(n,"error",t,r)}function R(n,t,r,s){if(typeof n.on=="function")s.once?n.once(t,r):n.on(t,r);else if(typeof n.addEventListener=="function")n.addEventListener(t,function o(c){s.once&&n.removeEventListener(t,o),r(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}return w.exports}var W=U();class T{emitter=new W.EventEmitter;emit(e,...i){this.emitter.emit(e,...i)}on(e,i){this.emitter.on(e,i)}off(e,i){this.emitter.off(e,i)}}function A(h){return(...e)=>new Promise((i,l)=>{h(...e,i,l)})}class F extends T{#n;#e;#t;#r;get id(){return this.#t}get roomType(){return this.#r}constructor(e,i,l){super(),this.#n=e,this.#t=i,this.#r=l}async sendEvent(e,...i){this.#e?.send("event",JSON.stringify([e,...i]))}async sendXml(e){this.#e?.send("xml",e)}async join(e={}){this.#n.client.multiplayer.useSecureConnections=location.protocol==="https:",this.#e=await A(this.#n.client.multiplayer.createJoinRoom)(this.#t,this.#r,!1,e.roomData||null,e.joinData||null),this.#e.addMessageCallback("event",i=>{const l=JSON.parse(i.getString(0));this.emit("event",...l)}),this.#e.addMessageCallback("xml",i=>{this.emit("xml",i.getString(0))}),this.#e.addDisconnectCallback(()=>{this.#e&&(this.#e=null,this.emit("left"))}),this.emit("joined")}}class K extends T{#n;#e;#t=!1;#r=new Map;#s=new Set;get client(){return this.#e}constructor(e,i=!1){super(),this.#n=e,this.#t=i}async connect(){if(this.#e)throw new Error("Already connected");this.#e=await A(window.PlayerIO.authenticate)(this.#n,"public",{userId:"Guest"},{}),this.#t&&(this.#e.multiplayer.developmentServer="localhost:8184"),this.emit("connected")}disconnect(){if(!this.#e)throw new Error("Not connected");this.#e.disconnect(),this.#e=null}async joinRoom(e,i,l={}){if(!this.#e)throw new Error("Not connected");if(this.#r.has(e))throw new Error("Already joined");if(this.#s.has(e))throw new Error("Already joining");const f=new F(this,e,i);return this.#s.add(e),f.on("joined",()=>{this.#r.set(f.id,f),this.emit("joinedRoom",f)}),f.on("left",()=>{this.#r.delete(f.id),this.emit("leftRoom",f)}),await f.join(l).finally(()=>{this.#s.delete(e)}),f}}class q extends EventTarget{addEventListener(e,i,l){super.addEventListener(e,i,l)}removeEventListener(e,i,l){super.removeEventListener(e,i,l)}}class y extends q{static#n=window.WebSocket;static#e=[];static register(e,i){const l={url:e,cb:i};return this.#e.push(l),()=>this.#e.splice(this.#e.indexOf(l),1)}static unregister(e,i){for(let l=this.#e.length-1;l>=0;l--){const f=this.#e[l];f.url.toString()===e.toString()&&(i&&f.cb!==i||this.#e.splice(l,1))}}static dataToString(e){return ArrayBuffer.isView(e)&&(e=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)),e instanceof ArrayBuffer&&(e=new TextDecoder().decode(e)),e instanceof Blob&&(e="[object Blob]"),e}static{window.WebSocket=this}static CONNECTING=0;static OPEN=1;static CLOSING=2;static CLOSED=3;CONNECTING=0;OPEN=1;CLOSING=2;CLOSED=3;protocol="";readyState=this.CLOSED;url="";extensions="";bufferedAmount=0;binaryType="arraybuffer";onopen=null;onclose=null;onmessage=null;onsend=null;onrecv=null;onerror=null;constructor(e,i){super(),this.url=new URL(e).href.replace(/[\/\\]*$/,"");const l=y.#e.filter(f=>typeof f.url=="string"?f.url===this.url:f.url.test(this.url));if(!l.length)return new y.#n(e,i);this.addEventListener("open",f=>this.onopen?.(f)),this.addEventListener("close",f=>this.onclose?.(f)),this.addEventListener("message",f=>this.onmessage?.(f)),this.addEventListener("send",f=>this.onsend?.(f)),this.addEventListener("recv",f=>this.onrecv?.(f)),this.addEventListener("error",f=>this.onerror?.(f)),i&&(this.protocol=typeof i=="string"?i:i.join(",")),this.readyState=this.CONNECTING,Promise.all([new Promise(f=>setTimeout(f,100)),...l.map(f=>f.cb(this))]).then(()=>{this.readyState=this.OPEN,this.dispatchEvent(new Event("open"))}).catch(()=>{this.readyState=this.CLOSED,this.dispatchEvent(new Event("error")),this.dispatchEvent(new CloseEvent("close",{wasClean:!1,code:1006,reason:""}))})}send(e){this.readyState===this.OPEN&&(e=this.#t(e),this.dispatchEvent(new MessageEvent("send",{data:e})))}recv(e){typeof e=="string"&&this.binaryType==="arraybuffer"&&(e=new TextEncoder().encode(e).buffer),this.readyState===this.OPEN&&(e=this.#t(e),this.dispatchEvent(new MessageEvent("recv",{data:e})),this.dispatchEvent(new MessageEvent("message",{data:e})))}close(e=1e3,i=""){if(this.readyState!==this.CLOSED&&this.readyState!==this.CLOSING){if(e!==1e3&&(e<3e3||e>4999))throw new Error("Invalid close code");if(i.length>123)throw new Error("Reason string too long");this.readyState=this.CLOSING,this.readyState=this.CLOSED,this.dispatchEvent(new CloseEvent("close",{wasClean:!0,code:e,reason:i}))}}#t(e){if(ArrayBuffer.isView(e)){const i=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);e=Reflect.construct(e.constructor,[i])}else e instanceof ArrayBuffer&&(e=e.slice(0));return e}}const M=new URLSearchParams(location.search).get("name")??`Player${Math.floor(Math.random()*99e3+1e3)}`,L=new URLSearchParams(location.search).get("motd");let v=null,p=null;y.register(/wss:\/\/localhost:4444/,async h=>{(!v||!p)&&(v=new K("bomberpengu-b3s34ovekbapmidml5oq"),await v.connect(),p=await v.joinRoom("lobby","Lobby",{joinData:{name:M}})),h.addEventListener("open",()=>{if(L)if(L.split(":").length>1){const[e,i]=L.split(":");h.send(`<msgAll name="${e}" msg="${i}" />\0`)}else h.send(`<msgAll name="System" msg="${L}" />\0`)}),h.addEventListener("send",({data:e})=>{if(!p)return;const l=y.dataToString(e).replace(/\0*$/,"").replace(/(<[ \t/]*)(\d)/g,"$1Tag$2");/<beat\//.test(l)||p.sendXml(l)}),p.on("xml",e=>{e=e.replace(/\0*$/,"\0").replace(/(<[ \t/]*)Tag(\d)/g,"$1$2"),e=e.replace(/\n\0$/g,"\0"),h.recv(e)}),p.on("left",()=>{h.close(),p=null,v?.disconnect(),v=null})});const E=window.RufflePlayer.newest().createPlayer();Object.assign(E.style,{width:"auto",height:"500px",placeSelf:"center",aspectRatio:"1/1",flexGrow:1});document.body.appendChild(E);E.load({url:"bomberpengu/game.swf",autoplay:"on",unmuteOverlay:"hidden",preloader:!1,splashScreen:!1,logLevel:"error",parameters:{surl:"localhost",sport:4444,sound:1,user:M,hash:"1bf6093ea530924697ca9cebd7bf4abb"},socketProxy:[{host:"localhost",port:4444,proxyUrl:"wss://localhost:4444"}]});
