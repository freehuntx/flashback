var ie=Object.defineProperty;var z=s=>{throw TypeError(s)};var oe=(s,a,e)=>a in s?ie(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var u=(s,a,e)=>oe(s,typeof a!="symbol"?a+"":a,e),H=(s,a,e)=>a.has(s)||z("Cannot "+e);var v=(s,a,e)=>(H(s,a,"read from private field"),e?e.call(s):a.get(s)),N=(s,a,e)=>a.has(s)?z("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(s):a.set(s,e),S=(s,a,e,o)=>(H(s,a,"write to private field"),o?o.call(s,e):a.set(s,e),e);import{r as $,j as W}from"./index-Xbzs_ivz.js";var D={exports:{}},Q;function ae(){if(Q)return D.exports;Q=1;var s=typeof Reflect=="object"?Reflect:null,a=s&&typeof s.apply=="function"?s.apply:function(t,i,f){return Function.prototype.apply.call(t,i,f)},e;s&&typeof s.ownKeys=="function"?e=s.ownKeys:Object.getOwnPropertySymbols?e=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:e=function(t){return Object.getOwnPropertyNames(t)};function o(r){console&&console.warn&&console.warn(r)}var h=Number.isNaN||function(t){return t!==t};function n(){n.init.call(this)}D.exports=n,D.exports.once=ne,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var m=10;function w(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(r){if(typeof r!="number"||r<0||h(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");m=r}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||h(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function l(r){return r._maxListeners===void 0?n.defaultMaxListeners:r._maxListeners}n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(t){for(var i=[],f=1;f<arguments.length;f++)i.push(arguments[f]);var c=t==="error",p=this._events;if(p!==void 0)c=c&&p.error===void 0;else if(!c)return!1;if(c){var d;if(i.length>0&&(d=i[0]),d instanceof Error)throw d;var O=new Error("Unhandled error."+(d?" ("+d.message+")":""));throw O.context=d,O}var A=p[t];if(A===void 0)return!1;if(typeof A=="function")a(A,this,i);else for(var X=A.length,se=J(A,X),f=0;f<X;++f)a(se[f],this,i);return!0};function y(r,t,i,f){var c,p,d;if(w(i),p=r._events,p===void 0?(p=r._events=Object.create(null),r._eventsCount=0):(p.newListener!==void 0&&(r.emit("newListener",t,i.listener?i.listener:i),p=r._events),d=p[t]),d===void 0)d=p[t]=i,++r._eventsCount;else if(typeof d=="function"?d=p[t]=f?[i,d]:[d,i]:f?d.unshift(i):d.push(i),c=l(r),c>0&&d.length>c&&!d.warned){d.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=r,O.type=t,O.count=d.length,o(O)}return r}n.prototype.addListener=function(t,i){return y(this,t,i,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,i){return y(this,t,i,!0)};function L(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(r,t,i){var f={fired:!1,wrapFn:void 0,target:r,type:t,listener:i},c=L.bind(f);return c.listener=i,f.wrapFn=c,c}n.prototype.once=function(t,i){return w(i),this.on(t,g(this,t,i)),this},n.prototype.prependOnceListener=function(t,i){return w(i),this.prependListener(t,g(this,t,i)),this},n.prototype.removeListener=function(t,i){var f,c,p,d,O;if(w(i),c=this._events,c===void 0)return this;if(f=c[t],f===void 0)return this;if(f===i||f.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete c[t],c.removeListener&&this.emit("removeListener",t,f.listener||i));else if(typeof f!="function"){for(p=-1,d=f.length-1;d>=0;d--)if(f[d]===i||f[d].listener===i){O=f[d].listener,p=d;break}if(p<0)return this;p===0?f.shift():ee(f,p),f.length===1&&(c[t]=f[0]),c.removeListener!==void 0&&this.emit("removeListener",t,O||i)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var i,f,c;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[t]),this;if(arguments.length===0){var p=Object.keys(f),d;for(c=0;c<p.length;++c)d=p[c],d!=="removeListener"&&this.removeAllListeners(d);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=f[t],typeof i=="function")this.removeListener(t,i);else if(i!==void 0)for(c=i.length-1;c>=0;c--)this.removeListener(t,i[c]);return this};function b(r,t,i){var f=r._events;if(f===void 0)return[];var c=f[t];return c===void 0?[]:typeof c=="function"?i?[c.listener||c]:[c]:i?te(c):J(c,c.length)}n.prototype.listeners=function(t){return b(this,t,!0)},n.prototype.rawListeners=function(t){return b(this,t,!1)},n.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):q.call(r,t)},n.prototype.listenerCount=q;function q(r){var t=this._events;if(t!==void 0){var i=t[r];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function J(r,t){for(var i=new Array(t),f=0;f<t;++f)i[f]=r[f];return i}function ee(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function te(r){for(var t=new Array(r.length),i=0;i<t.length;++i)t[i]=r[i].listener||r[i];return t}function ne(r,t){return new Promise(function(i,f){function c(d){r.removeListener(t,p),f(d)}function p(){typeof r.removeListener=="function"&&r.removeListener("error",c),i([].slice.call(arguments))}V(r,t,p,{once:!0}),t!=="error"&&re(r,c,{once:!0})})}function re(r,t,i){typeof r.on=="function"&&V(r,"error",t,i)}function V(r,t,i,f){if(typeof r.on=="function")f.once?r.once(t,i):r.on(t,i);else if(typeof r.addEventListener=="function")r.addEventListener(t,function c(p){f.once&&r.removeEventListener(t,c),i(p)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}return D.exports}var B=ae();const E=class E extends B.EventEmitter{constructor(e,o=[]){super();u(this,"CONNECTING",0);u(this,"OPEN",1);u(this,"CLOSING",2);u(this,"CLOSED",3);u(this,"bufferedAmount",0);u(this,"binaryType","arraybuffer");u(this,"protocol","");u(this,"readyState",E.CONNECTING);u(this,"url","");u(this,"extensions",{});u(this,"isPaused",!1);u(this,"_ping",0);u(this,"_events",new EventTarget);u(this,"onopen",null);u(this,"onmessage",null);u(this,"onerror",null);u(this,"onclose",null);this.url=typeof e=="string"?e:e.href,this.protocol=typeof o=="string"?o:o.join(","),this.on("open",()=>{var n;this.readyState=E.OPEN;const h=new Event("open");(n=this.onopen)==null||n.call(this,h),this.dispatchEvent(h)}),this.on("message",h=>{var m;const n=new MessageEvent("message",{data:h});(m=this.onmessage)==null||m.call(this,n),this.dispatchEvent(n)}),this.on("close",(h,n)=>{var w;this.readyState=E.CLOSED;const m=new CloseEvent("close",{code:h,reason:n});(w=this.onclose)==null||w.call(this,m),this.dispatchEvent(m)}),this.on("error",h=>{var m;const n=new ErrorEvent("error",{error:h});(m=this.onerror)==null||m.call(this,n),this.dispatchEvent(n)})}setPing(e){this._ping=e<0?0:e}send(e){this.binaryType==="arraybuffer"&&(typeof e=="string"?e=new TextEncoder().encode(e).buffer:ArrayBuffer.isView(e)&&(e=e.buffer)),setTimeout(()=>{this.emit("send",e)},this._ping/2)}pause(){if(this.readyState!==E.CONNECTING&&this.readyState!==E.CLOSED)throw new Error("pause not implemented")}ping(e,o,h){throw new Error("ping not implemented")}pong(e,o,h){throw new Error("pong not implemented")}resume(){if(this.readyState!==E.CONNECTING&&this.readyState!==E.CLOSED)throw new Error("resume not implemented")}close(e=1e3,o=""){this.readyState===E.OPEN&&(this.readyState=E.CLOSING),this.readyState!=E.CLOSED&&(this.readyState=E.CLOSED,setTimeout(()=>{this.emit("close",e,o)},this._ping/2))}terminate(){throw new Error("terminate not implemented")}addEventListener(e,o){this._events.addEventListener(e,o)}removeEventListener(e,o){this._events.removeEventListener(e,o)}dispatchEvent(e){return this._events.dispatchEvent(e)}};u(E,"CONNECTING",0),u(E,"OPEN",1),u(E,"CLOSING",2),u(E,"CLOSED",3);let K=E;class fe extends B.EventEmitter{constructor(e={}){super();u(this,"_host");u(this,"_port");u(this,"_ping");u(this,"_url");this._ping=e.ping??0,this._host=e.host??"0.0.0.0",this._port=e.port??(location.protocol==="https:"?443:80),this._url=e.url,this._hookWebSocket()}get ping(){return this._ping}address(){var e;return{family:((e=this._host)==null?void 0:e.indexOf(":"))!==-1?"IPv6":"IPv4",address:this._host,port:this._port}}_hookWebSocket(){const e=this,o=window.WebSocket,n=class n extends EventTarget{constructor(l,y=[]){super();u(this,"CONNECTING",0);u(this,"OPEN",1);u(this,"CLOSING",2);u(this,"CLOSED",3);u(this,"_binaryType","blob");u(this,"bufferedAmount",0);u(this,"protocol","");u(this,"readyState",0);u(this,"url","");u(this,"extensions","");u(this,"wsClient",null);u(this,"onopen",null);u(this,"onmessage",null);u(this,"onerror",null);u(this,"onclose",null);this.url=typeof l=="string"?l:l.href;let L=!1;if(e._url)L=new RegExp(e._url.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")).test(this.url);else{const g=e.address();L=this.url.indexOf(`://${g.address}:${g.port}`)!==-1}if(!L)return new o(l,y);this.readyState=n.CONNECTING,this.protocol=typeof y=="string"?y:y.join(","),this.wsClient=new K(l,y),this.wsClient.on("open",()=>{e.emit("connection",this.wsClient)}),this.wsClient.on("send",g=>{const b=new MessageEvent("message",{data:g});this.dispatchEvent(b)}),this.addEventListener("open",g=>{var b;(b=this.onopen)==null||b.call(this,g),setTimeout(()=>{this.wsClient.emit("open")},e.ping/2)}),this.addEventListener("message",g=>{var b;(b=this.onmessage)==null||b.call(this,g)}),this.addEventListener("close",g=>{var b;(b=this.onclose)==null||b.call(this,g),setTimeout(()=>{this.wsClient.emit("close")},e.ping/2)}),this.addEventListener("error",g=>{var b;(b=this.onerror)==null||b.call(this,g)}),setTimeout(()=>{this.readyState=n.OPEN,this.dispatchEvent(new Event("open"))},100)}get binaryType(){return this._binaryType}set binaryType(l){this._binaryType=l,l==="arraybuffer"&&(this.wsClient.binaryType=l)}close(){if(this.readyState===n.CLOSING||this.readyState===n.CLOSED)throw new Error("WebSocket is not open");this.readyState=n.CLOSING,this.readyState=n.CLOSED,this.dispatchEvent(new Event("close"))}send(l){if(this.readyState!==n.OPEN)throw new Error("WebSocket is not open");if(ArrayBuffer.isView(l)){const y=l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength);l=Reflect.construct(l.constructor,[y])}else l instanceof ArrayBuffer&&(l=l.slice(0));this.binaryType==="arraybuffer"&&(typeof l=="string"?l=new TextEncoder().encode(l).buffer:ArrayBuffer.isView(l)&&(l=l.buffer)),setTimeout(()=>{this.wsClient.emit("message",l)},e.ping/2)}};u(n,"CONNECTING",0),u(n,"OPEN",1),u(n,"CLOSING",2),u(n,"CLOSED",3);let h=n;window.WebSocket=h}}function ue({config:s,style:a,className:e,...o}){const h=$.useRef(null);return $.useEffect(()=>{const{current:n}=h;if(!n||!s)return;const m=window.RufflePlayer.newest().createPlayer();a&&Object.assign(m.style,a),e&&(m.className=e);const w=[];return Object.entries(o).forEach(([l,y])=>{if(l.startsWith("on")){const L=l.toLowerCase().substring(2);m.addEventListener(L,y),w.push({eventName:L,listener:y})}else m.setAttribute(l,y)}),n.replaceWith(m),m.load(s),()=>{w.forEach(({eventName:l,listener:y})=>{m.removeEventListener(l,y)}),m.replaceWith(n)}},[s,a,e,o]),W.jsx("div",{ref:h})}function G(s){return s&&typeof s=="object"&&!Array.isArray(s)}function U(s,...a){if(!a.length)return s;const e=a.shift();if(G(s)&&G(e))for(const o in e)G(e[o])?(s[o]||Object.assign(s,{[o]:{}}),U(s[o],e[o])):Object.assign(s,{[o]:e[o]});return U(s,...a)}function ce({proxies:s,config:a,...e}){const o=$.useMemo(()=>U(a,{socketProxy:s.map(({host:h,port:n})=>({host:h,port:n,proxyUrl:`wss://${h}:${n}`}))}),[a,s]);return $.useEffect(()=>{if(!s)return;let h=s.map(n=>{const m=new fe({host:n.host,port:n.port});return m.on("connection",w=>{var l;(l=n.onConnect)==null||l.call(n,w),w.on("message",y=>{var L;(L=n.onMessage)==null||L.call(n,w,y)}),w.on("close",(y,L)=>{var g;(g=n.onDisconnect)==null||g.call(n,w,y,L)})}),m});return()=>{for(const n of h);h=[]}},[s]),W.jsx(ue,{...e,config:o})}class Y{constructor(){u(this,"emitter",new B.EventEmitter)}emit(a,...e){this.emitter.emit(a,...e)}on(a,e){this.emitter.on(a,e)}off(a,e){this.emitter.off(a,e)}}function Z(s){return(...a)=>new Promise((e,o)=>{s(...a,e,o)})}var j,C,T,P;class le extends Y{constructor(e,o,h){super();N(this,j);N(this,C);N(this,T);N(this,P);S(this,j,e),S(this,T,o),S(this,P,h)}get id(){return v(this,T)}get roomType(){return v(this,P)}async sendEvent(e,...o){var h;(h=v(this,C))==null||h.send("event",JSON.stringify([e,...o]))}async sendXml(e){var o;(o=v(this,C))==null||o.send("xml",e)}async join(e={}){v(this,j).client.multiplayer.useSecureConnections=location.protocol==="https:",S(this,C,await Z(v(this,j).client.multiplayer.createJoinRoom)(v(this,T),v(this,P),!1,e.roomData||null,e.joinData||null)),v(this,C).addMessageCallback("event",o=>{const h=JSON.parse(o.getString(0));this.emit("event",...h)}),v(this,C).addMessageCallback("xml",o=>{this.emit("xml",o.getString(0))}),v(this,C).addDisconnectCallback(()=>{v(this,C)&&(S(this,C,null),this.emit("left"))}),this.emit("joined")}}j=new WeakMap,C=new WeakMap,T=new WeakMap,P=new WeakMap;var M,_,I,R,x;class he extends Y{constructor(e,o=!1){super();N(this,M);N(this,_);N(this,I,!1);N(this,R,new Map);N(this,x,new Set);S(this,M,e),S(this,I,o)}get client(){return v(this,_)}async connect(){if(v(this,_))throw new Error("Already connected");S(this,_,await Z(window.PlayerIO.authenticate)(v(this,M),"public",{userId:"Guest"},{})),v(this,I)&&(v(this,_).multiplayer.developmentServer="localhost:8184"),this.emit("connected")}async joinRoom(e,o,h={}){if(!v(this,_))throw new Error("Not connected");if(v(this,R).has(e))throw new Error("Already joined");if(v(this,x).has(e))throw new Error("Already joining");const n=new le(this,e,o);return v(this,x).add(e),n.on("joined",()=>{v(this,R).set(n.id,n),this.emit("joinedRoom",n)}),n.on("left",()=>{v(this,R).delete(n.id),this.emit("leftRoom",n)}),await n.join(h).finally(()=>{v(this,x).delete(e)}),n}}M=new WeakMap,_=new WeakMap,I=new WeakMap,R=new WeakMap,x=new WeakMap;const de="/flashback/assets/game-CH1HMyxt.swf",k=new URLSearchParams(location.search).get("name")??`Player${Math.floor(Math.random()*99e3+1e3)}`,F={host:"bomberpengu.local",port:1337,async onConnect(s){const a=o=>{throw o&&s.send(`<errorMsg>${o}</errorMsg>\0`),s.close(),new Error(o)};(s.pio||s.lobby)&&a("Already connected"),s.pio=new he("bomberpengu-b3s34ovekbapmidml5oq");try{if(!s.pio)throw new Error("pio not found");await s.pio.connect(),s.lobby=await s.pio.joinRoom("lobby","Lobby",{joinData:{name:k}})}catch(o){console.error(o),a("Connecting failed!")}const e=new URLSearchParams(location.search).get("motd");if(e)if(e.split(":").length>1){const[o,h]=e.split(":");s.send(`<msgAll name="${o}" msg="${h}" />\0`)}else s.send(`<msgAll name="System" msg="${e}" />\0`);s.lobby.on("xml",o=>{o=o.replace(/\0*$/,"\0").replace(/(<[ \t/]*)Tag(\d)/g,"$1$2"),o=o.replace(/\n\0$/g,"\0"),s.send(o)}),s.lobby.on("left",()=>{a("Disconnected")})},onDisconnect(s){},async onMessage(s,a){var o;const e=new TextDecoder().decode(a).replace(/\0*$/,"").replace(/(<[ \t/]*)(\d)/g,"$1Tag$2");/<beat\//.test(e)||(o=s.lobby)==null||o.sendXml(e)}};function me(){return W.jsx(ce,{proxies:[F],config:{url:de,autoplay:"on",unmuteOverlay:"hidden",preloader:!1,splashScreen:!1,logLevel:"error",parameters:{surl:F.host,sport:F.port,sound:1,user:k,hash:"1bf6093ea530924697ca9cebd7bf4abb"}},width:"500",height:"500",style:{justifySelf:"center",alignSelf:"center",aspectRatio:"1/1",width:"auto"}})}export{me as default};
