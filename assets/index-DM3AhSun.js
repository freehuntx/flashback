var oe=Object.defineProperty;var Z=r=>{throw TypeError(r)};var fe=(r,f,e)=>f in r?oe(r,f,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[f]=e;var u=(r,f,e)=>fe(r,typeof f!="symbol"?f+"":f,e),Q=(r,f,e)=>f.has(r)||Z("Cannot "+e);var v=(r,f,e)=>(Q(r,f,"read from private field"),e?e.call(r):f.get(r)),N=(r,f,e)=>f.has(r)?Z("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(r):f.set(r,e),S=(r,f,e,i)=>(Q(r,f,"write to private field"),i?i.call(r,e):f.set(r,e),e);import{r as j,j as q}from"./index-D2Wuw24R.js";var $={exports:{}},Y;function ae(){if(Y)return $.exports;Y=1;var r=typeof Reflect=="object"?Reflect:null,f=r&&typeof r.apply=="function"?r.apply:function(t,o,a){return Function.prototype.apply.call(t,o,a)},e;r&&typeof r.ownKeys=="function"?e=r.ownKeys:Object.getOwnPropertySymbols?e=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:e=function(t){return Object.getOwnPropertyNames(t)};function i(s){console&&console.warn&&console.warn(s)}var l=Number.isNaN||function(t){return t!==t};function n(){n.init.call(this)}$.exports=n,$.exports.once=re,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var w=10;function E(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(s){if(typeof s!="number"||s<0||l(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");w=s}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||l(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function d(s){return s._maxListeners===void 0?n.defaultMaxListeners:s._maxListeners}n.prototype.getMaxListeners=function(){return d(this)},n.prototype.emit=function(t){for(var o=[],a=1;a<arguments.length;a++)o.push(arguments[a]);var c=t==="error",p=this._events;if(p!==void 0)c=c&&p.error===void 0;else if(!c)return!1;if(c){var h;if(o.length>0&&(h=o[0]),h instanceof Error)throw h;var L=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw L.context=h,L}var M=p[t];if(M===void 0)return!1;if(typeof M=="function")f(M,this,o);else for(var z=M.length,ie=X(M,z),a=0;a<z;++a)f(ie[a],this,o);return!0};function b(s,t,o,a){var c,p,h;if(E(o),p=s._events,p===void 0?(p=s._events=Object.create(null),s._eventsCount=0):(p.newListener!==void 0&&(s.emit("newListener",t,o.listener?o.listener:o),p=s._events),h=p[t]),h===void 0)h=p[t]=o,++s._eventsCount;else if(typeof h=="function"?h=p[t]=a?[o,h]:[h,o]:a?h.unshift(o):h.push(o),c=d(s),c>0&&h.length>c&&!h.warned){h.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=s,L.type=t,L.count=h.length,i(L)}return s}n.prototype.addListener=function(t,o){return b(this,t,o,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,o){return b(this,t,o,!0)};function C(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(s,t,o){var a={fired:!1,wrapFn:void 0,target:s,type:t,listener:o},c=C.bind(a);return c.listener=o,a.wrapFn=c,c}n.prototype.once=function(t,o){return E(o),this.on(t,m(this,t,o)),this},n.prototype.prependOnceListener=function(t,o){return E(o),this.prependListener(t,m(this,t,o)),this},n.prototype.removeListener=function(t,o){var a,c,p,h,L;if(E(o),c=this._events,c===void 0)return this;if(a=c[t],a===void 0)return this;if(a===o||a.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete c[t],c.removeListener&&this.emit("removeListener",t,a.listener||o));else if(typeof a!="function"){for(p=-1,h=a.length-1;h>=0;h--)if(a[h]===o||a[h].listener===o){L=a[h].listener,p=h;break}if(p<0)return this;p===0?a.shift():te(a,p),a.length===1&&(c[t]=a[0]),c.removeListener!==void 0&&this.emit("removeListener",t,L||o)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var o,a,c;if(a=this._events,a===void 0)return this;if(a.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):a[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete a[t]),this;if(arguments.length===0){var p=Object.keys(a),h;for(c=0;c<p.length;++c)h=p[c],h!=="removeListener"&&this.removeAllListeners(h);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=a[t],typeof o=="function")this.removeListener(t,o);else if(o!==void 0)for(c=o.length-1;c>=0;c--)this.removeListener(t,o[c]);return this};function g(s,t,o){var a=s._events;if(a===void 0)return[];var c=a[t];return c===void 0?[]:typeof c=="function"?o?[c.listener||c]:[c]:o?ne(c):X(c,c.length)}n.prototype.listeners=function(t){return g(this,t,!0)},n.prototype.rawListeners=function(t){return g(this,t,!1)},n.listenerCount=function(s,t){return typeof s.listenerCount=="function"?s.listenerCount(t):V.call(s,t)},n.prototype.listenerCount=V;function V(s){var t=this._events;if(t!==void 0){var o=t[s];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function X(s,t){for(var o=new Array(t),a=0;a<t;++a)o[a]=s[a];return o}function te(s,t){for(;t+1<s.length;t++)s[t]=s[t+1];s.pop()}function ne(s){for(var t=new Array(s.length),o=0;o<t.length;++o)t[o]=s[o].listener||s[o];return t}function re(s,t){return new Promise(function(o,a){function c(h){s.removeListener(t,p),a(h)}function p(){typeof s.removeListener=="function"&&s.removeListener("error",c),o([].slice.call(arguments))}W(s,t,p,{once:!0}),t!=="error"&&se(s,c,{once:!0})})}function se(s,t,o){typeof s.on=="function"&&W(s,"error",t,o)}function W(s,t,o,a){if(typeof s.on=="function")a.once?s.once(t,o):s.on(t,o);else if(typeof s.addEventListener=="function")s.addEventListener(t,function c(p){a.once&&s.removeEventListener(t,c),o(p)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}return $.exports}var J=ae();const y=class y extends J.EventEmitter{constructor(e,i=[]){super();u(this,"CONNECTING",0);u(this,"OPEN",1);u(this,"CLOSING",2);u(this,"CLOSED",3);u(this,"bufferedAmount",0);u(this,"binaryType","arraybuffer");u(this,"protocol","");u(this,"readyState",y.CONNECTING);u(this,"url","");u(this,"extensions",{});u(this,"isPaused",!1);u(this,"_ping",0);u(this,"_events",new EventTarget);u(this,"onopen",null);u(this,"onmessage",null);u(this,"onerror",null);u(this,"onclose",null);this.url=typeof e=="string"?e:e.href,this.protocol=typeof i=="string"?i:i.join(","),this.on("open",()=>{var n;this.readyState=y.OPEN;const l=new Event("open");(n=this.onopen)==null||n.call(this,l),this.dispatchEvent(l)}),this.on("message",l=>{var w;const n=new MessageEvent("message",{data:l});(w=this.onmessage)==null||w.call(this,n),this.dispatchEvent(n)}),this.on("close",(l,n)=>{var E;this.readyState=y.CLOSED;const w=new CloseEvent("close",{code:l,reason:n});(E=this.onclose)==null||E.call(this,w),this.dispatchEvent(w)}),this.on("error",l=>{var w;const n=new ErrorEvent("error",{error:l});(w=this.onerror)==null||w.call(this,n),this.dispatchEvent(n)})}setPing(e){this._ping=e<0?0:e}send(e){this.binaryType==="arraybuffer"&&(typeof e=="string"?e=new TextEncoder().encode(e).buffer:ArrayBuffer.isView(e)&&(e=e.buffer)),setTimeout(()=>{this.emit("send",e)},this._ping/2)}pause(){if(this.readyState!==y.CONNECTING&&this.readyState!==y.CLOSED)throw new Error("pause not implemented")}ping(e,i,l){throw new Error("ping not implemented")}pong(e,i,l){throw new Error("pong not implemented")}resume(){if(this.readyState!==y.CONNECTING&&this.readyState!==y.CLOSED)throw new Error("resume not implemented")}close(e=1e3,i=""){this.readyState===y.OPEN&&(this.readyState=y.CLOSING),this.readyState!=y.CLOSED&&(this.readyState=y.CLOSED,setTimeout(()=>{this.emit("close",e,i)},this._ping/2))}terminate(){throw new Error("terminate not implemented")}addEventListener(e,i){this._events.addEventListener(e,i)}removeEventListener(e,i){this._events.removeEventListener(e,i)}dispatchEvent(e){return this._events.dispatchEvent(e)}};u(y,"CONNECTING",0),u(y,"OPEN",1),u(y,"CLOSING",2),u(y,"CLOSED",3);let B=y;class ue extends J.EventEmitter{constructor(e={}){super();u(this,"_host");u(this,"_port");u(this,"_ping");u(this,"_url");this._ping=e.ping??0,this._host=e.host??"0.0.0.0",this._port=e.port??(location.protocol==="https:"?443:80),this._url=e.url,this._hookWebSocket()}get ping(){return this._ping}address(){var e;return{family:((e=this._host)==null?void 0:e.indexOf(":"))!==-1?"IPv6":"IPv4",address:this._host,port:this._port}}_hookWebSocket(){const e=this,i=window.WebSocket,n=class n extends EventTarget{constructor(d,b=[]){super();u(this,"CONNECTING",0);u(this,"OPEN",1);u(this,"CLOSING",2);u(this,"CLOSED",3);u(this,"_binaryType","blob");u(this,"bufferedAmount",0);u(this,"protocol","");u(this,"readyState",0);u(this,"url","");u(this,"extensions","");u(this,"wsClient",null);u(this,"onopen",null);u(this,"onmessage",null);u(this,"onerror",null);u(this,"onclose",null);this.url=typeof d=="string"?d:d.href;let C=!1;if(e._url)C=new RegExp(e._url.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")).test(this.url);else{const m=e.address();C=this.url.indexOf(`://${m.address}:${m.port}`)!==-1}if(!C)return new i(d,b);this.readyState=n.CONNECTING,this.protocol=typeof b=="string"?b:b.join(","),this.wsClient=new B(d,b),this.wsClient.on("open",()=>{e.emit("connection",this.wsClient)}),this.wsClient.on("send",m=>{const g=new MessageEvent("message",{data:m});this.dispatchEvent(g)}),this.addEventListener("open",m=>{var g;(g=this.onopen)==null||g.call(this,m),setTimeout(()=>{this.wsClient.emit("open")},e.ping/2)}),this.addEventListener("message",m=>{var g;(g=this.onmessage)==null||g.call(this,m)}),this.addEventListener("close",m=>{var g;(g=this.onclose)==null||g.call(this,m),setTimeout(()=>{this.wsClient.emit("close")},e.ping/2)}),this.addEventListener("error",m=>{var g;(g=this.onerror)==null||g.call(this,m)}),setTimeout(()=>{this.readyState=n.OPEN,this.dispatchEvent(new Event("open"))},100)}get binaryType(){return this._binaryType}set binaryType(d){this._binaryType=d,d==="arraybuffer"&&(this.wsClient.binaryType=d)}close(){if(this.readyState===n.CLOSING||this.readyState===n.CLOSED)throw new Error("WebSocket is not open");this.readyState=n.CLOSING,this.readyState=n.CLOSED,this.dispatchEvent(new Event("close"))}send(d){if(this.readyState!==n.OPEN)throw new Error("WebSocket is not open");if(ArrayBuffer.isView(d)){const b=d.buffer.slice(d.byteOffset,d.byteOffset+d.byteLength);d=Reflect.construct(d.constructor,[b])}else d instanceof ArrayBuffer&&(d=d.slice(0));this.binaryType==="arraybuffer"&&(typeof d=="string"?d=new TextEncoder().encode(d).buffer:ArrayBuffer.isView(d)&&(d=d.buffer)),setTimeout(()=>{this.wsClient.emit("message",d)},e.ping/2)}};u(n,"CONNECTING",0),u(n,"OPEN",1),u(n,"CLOSING",2),u(n,"CLOSED",3);let l=n;window.WebSocket=l}}function K(r,f){const e=j.useRef(!1);j.useEffect(()=>{if(!e.current){e.current=!0;return}return r()},f)}function ce({config:r,...f}){const[e]=j.useState(window.RufflePlayer.newest().createPlayer()),i=j.useRef(null);return Object.assign(e.style,{display:"block",width:"100%",height:"100%"}),K(()=>{if(i.current)return i.current.appendChild(e),()=>{var l;(l=i.current)==null||l.removeChild(e)}},[i]),K(()=>{e.load(r)},[r]),q.jsx("div",{ref:i,...f})}function G(r){return r&&typeof r=="object"&&!Array.isArray(r)}function U(r,...f){if(!f.length)return r;const e=f.shift();if(G(r)&&G(e))for(const i in e)G(e[i])?(r[i]||Object.assign(r,{[i]:{}}),U(r[i],e[i])):Object.assign(r,{[i]:e[i]});return U(r,...f)}function le(r,f){const e=j.useRef(r()),i=j.useRef(!1);return j.useEffect(()=>{if(i.current===!1){i.current=!0;return}const l=r();e.current!==l&&(e.current=l)},f),e.current}function he({proxies:r,config:f,...e}){const i=le(()=>U(f,{socketProxy:r.map(({host:l,port:n})=>({host:l,port:n,proxyUrl:`wss://${l}:${n}`}))}),[f]);return K(()=>{if(!r)return;let l=r.map(n=>{const w=new ue({host:n.host,port:n.port});return w.on("connection",E=>{var d;(d=n.onConnect)==null||d.call(n,E),E.on("message",b=>{var C;(C=n.onMessage)==null||C.call(n,E,b)}),E.on("close",(b,C)=>{var m;(m=n.onDisconnect)==null||m.call(n,E,b,C)})}),w});return()=>{for(const n of l);l=[]}},[r]),q.jsx(ce,{...e,config:i})}class H{constructor(){u(this,"emitter",new J.EventEmitter)}emit(f,...e){this.emitter.emit(f,...e)}on(f,e){this.emitter.on(f,e)}off(f,e){this.emitter.off(f,e)}}function k(r){return(...f)=>new Promise((e,i)=>{r(...f,e,i)})}var R,O,T,P;class de extends H{constructor(e,i,l){super();N(this,R);N(this,O);N(this,T);N(this,P);S(this,R,e),S(this,T,i),S(this,P,l)}get id(){return v(this,T)}get roomType(){return v(this,P)}async sendEvent(e,...i){var l;(l=v(this,O))==null||l.send("event",JSON.stringify([e,...i]))}async sendXml(e){var i;(i=v(this,O))==null||i.send("xml",e)}async join(e={}){v(this,R).client.multiplayer.useSecureConnections=location.protocol==="https:",S(this,O,await k(v(this,R).client.multiplayer.createJoinRoom)(v(this,T),v(this,P),!1,e.roomData||null,e.joinData||null)),v(this,O).addMessageCallback("event",i=>{const l=JSON.parse(i.getString(0));this.emit("event",...l)}),v(this,O).addMessageCallback("xml",i=>{this.emit("xml",i.getString(0))}),v(this,O).addDisconnectCallback(()=>{v(this,O)&&(S(this,O,null),this.emit("left"))}),this.emit("joined")}}R=new WeakMap,O=new WeakMap,T=new WeakMap,P=new WeakMap;var I,_,D,x,A;class pe extends H{constructor(e,i=!1){super();N(this,I);N(this,_);N(this,D,!1);N(this,x,new Map);N(this,A,new Set);S(this,I,e),S(this,D,i)}get client(){return v(this,_)}async connect(){if(v(this,_))throw new Error("Already connected");S(this,_,await k(window.PlayerIO.authenticate)(v(this,I),"public",{userId:"Guest"},{})),v(this,D)&&(v(this,_).multiplayer.developmentServer="localhost:8184"),this.emit("connected")}async joinRoom(e,i,l={}){if(!v(this,_))throw new Error("Not connected");if(v(this,x).has(e))throw new Error("Already joined");if(v(this,A).has(e))throw new Error("Already joining");const n=new de(this,e,i);return v(this,A).add(e),n.on("joined",()=>{v(this,x).set(n.id,n),this.emit("joinedRoom",n)}),n.on("left",()=>{v(this,x).delete(n.id),this.emit("leftRoom",n)}),await n.join(l).finally(()=>{v(this,A).delete(e)}),n}}I=new WeakMap,_=new WeakMap,D=new WeakMap,x=new WeakMap,A=new WeakMap;const ve="/flashback/assets/game-Z6BRzXyh.swf",ee=new URLSearchParams(location.search).get("name")??`Player${Math.floor(Math.random()*99e3+1e3)}`,F={host:"bomberpengu.local",port:1337,async onConnect(r){const f=i=>{throw i&&r.send(`<errorMsg>${i}</errorMsg>\0`),r.close(),new Error(i)};(r.pio||r.lobby)&&f("Already connected"),r.pio=new pe("bomberpengu-b3s34ovekbapmidml5oq");try{if(!r.pio)throw new Error("pio not found");await r.pio.connect(),r.lobby=await r.pio.joinRoom("lobby","Lobby",{joinData:{name:ee}})}catch(i){console.error(i),f("Connecting failed!")}const e=new URLSearchParams(location.search).get("motd");if(e)if(e.split(":").length>1){const[i,l]=e.split(":");r.send(`<msgAll name="${i}" msg="${l}" />\0`)}else r.send(`<msgAll name="System" msg="${e}" />\0`);r.lobby.on("xml",i=>{i=i.replace(/\0*$/,"\0").replace(/(<[ \t/]*)Tag(\d)/g,"$1$2"),i=i.replace(/\n\0$/g,"\0"),r.send(i)}),r.lobby.on("left",()=>{f("Disconnected")})},onDisconnect(r){},async onMessage(r,f){var i;const e=new TextDecoder().decode(f).replace(/\0*$/,"").replace(/(<[ \t/]*)(\d)/g,"$1Tag$2");/<beat\//.test(e)||(i=r.lobby)==null||i.sendXml(e)}};function ge(){return q.jsx(he,{proxies:[F],config:{url:ve,autoplay:"on",unmuteOverlay:"hidden",preloader:!1,splashScreen:!1,logLevel:"error",parameters:{surl:F.host,sport:F.port,sound:1,user:ee,hash:"1bf6093ea530924697ca9cebd7bf4abb"}},width:"500",height:"500",style:{justifySelf:"center",alignSelf:"center",aspectRatio:"1/1",width:"auto"}})}export{ge as Render,ge as default};
