---
import Layout from '@/layouts/Layout.astro'
import { existsSync, readdirSync, readFileSync } from 'node:fs'

const currentUrl = Astro.url.href.replace(/[\/\\]*$/, '')
const projects = readdirSync(import.meta.dirname, { withFileTypes: true })
  .filter(e => e.isDirectory() && e.name !== 'public')
  .map(e => {
    const manifestPath = `${import.meta.dirname}/${e.name}/manifest.json`
    const manifest = JSON.parse(existsSync(manifestPath) ? readFileSync(manifestPath).toString() : '{}')
    return {
      id: e.name,
      name: manifest.name ?? e.name,
      description: manifest.description ?? '',
      logo: `${e.name}/${manifest.logo ?? 'logo.png'}`
    }
  })
---

<Layout title="Game list">
  <div class="game-library">
    {projects.map(({ id, name, logo }) => (
      <a href={`${currentUrl}/${id}`}>
        <img alt={name} src={logo} />
        <span>{name}</span>
      </a>
    ))}
  </div>
  <style>
    .game-library {
      display: flex;
      flex-wrap: wrap;
      overflow: clip auto;
      width: 80%;
      justify-content: center;
    }

    .game-library > a {
      display: flex;
      flex-direction: column;
      margin: 1rem;
      width: 10%;
      min-width: 100px;
      text-decoration: unset;
    }
  </style>
</Layout>
